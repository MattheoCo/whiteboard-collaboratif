#!/usr/bin/env php
<?php

use App\Entity\User;
use Doctrine\ORM\EntityManagerInterface;
use Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface;

require_once dirname(__DIR__).'/vendor/autoload_runtime.php';

return function (array $context) {
    $kernel = new \App\Kernel($context['APP_ENV'], (bool) $context['APP_DEBUG']);
    $kernel->boot();
    $container = $kernel->getContainer();
    
    $em = $container->get(EntityManagerInterface::class);
    $hasher = $container->get(UserPasswordHasherInterface::class);
    
    // Créer admin par défaut
    $admin = new User();
    $admin->setEmail('admin@whiteboard.app');
    $admin->setPassword($hasher->hashPassword($admin, 'admin123'));
    
    $em->persist($admin);
    $em->flush();
    
    echo "Admin créé : admin@whiteboard.app / admin123\n";
    
    return 0;
};
